---
title: "p8105_hw2_th3147"
author: "Te-Hsuan Huang"
date: "2025-09-27"
output: github_document
---

# Problem 1

1. First dataset

```{r}
library(tidyverse)

polsmonth_df = read_csv(file = "./fivethirtyeight_datasets/pols-month.csv") |> 
  janitor::clean_names() |> 
  separate(mon, into = c("year", "month", "day"), sep = "-") |> 
 mutate( 
   year = as.numeric(year),
    month = case_match(
      month,
      "01" ~ "jan",
      "02" ~ "feb",
      "03" ~ "mar",
      "04" ~ "apr",
      "05" ~ "may",
      "06" ~ "jun",
      "07" ~ "jul",
      "08" ~ "aug",
      "09" ~ "sep",
      "10" ~ "oct",
      "11" ~ "nov",
      "12" ~ "dec"
    ), 
    
    president = case_match(
      prez_dem,
      1 ~ "dem",
      0 ~ "gop")) |> 
    select(-prez_dem, -prez_gop, -day)

polsmonth_df
  
```

* make sure the lower case in month.

2. second dataset

```{r}
snp_df = read_csv(file = "./fivethirtyeight_datasets/snp.csv") |> 
  janitor::clean_names() |> 
  separate(date, into = c("month", "day", "year"), sep = "/") |>
  mutate(
    year = as.integer(paste0("20", year)),
    year = as.numeric(year),
    month = case_match(
      month,
      "1" ~ "jan",
      "2" ~ "feb",
      "3" ~ "mar",
      "4" ~ "apr",
      "5" ~ "may",
      "6" ~ "jun",
      "7" ~ "jul",
      "8" ~ "aug",
      "9" ~ "sep",
      "10" ~ "oct",
      "11" ~ "nov",
      "12" ~ "dec"
    )) |> 
      select(-day) |>
      arrange (year, month) |> 
      relocate(year, month)

snp_df
```

* paste0: is a function in R used to concatenate (join together) character strings.

* make sure the lower case in month.


3. Third dataset

```{r}
unemploy_df = read_csv(file = "./fivethirtyeight_datasets/unemployment.csv") |> 
  janitor::clean_names() |> 
  pivot_longer(
    jan:dec,
    names_to = "month", 
    values_to = "unemployment_rate") |> 
  relocate(year, month) |>
  arrange(year, month)

unemploy_df
```

4. Merge the dataset

```{r}
final_merged_df = 
   polsmonth_df |>
  left_join(snp_df, by = c("year", "month")) |>
  left_join(unemploy_df, by = c("year", "month"))

final_merged_df
```

* Keep in mind: 

1. the features of year and month in each dataset should be same.

2. the alphabet should be exactly same in month.

* The resulting dataset is a time-series data frame created by merging three original sources: pols-month.csv, which contains U.S. political control data (including the number of Democratic and Republican governors and the party of the sitting President); snp.csv, which tracks the S&P 500 closing price; and unemployment.csv, which records the national unemployment rate. After joining the three files on the common keys of year and month, the final merged dataset contains `r nrow(final_merged_df)` rows and `r ncol(final_merged_df)` columns, covering the time span from 1947 to 2015. Key variables include the date identifiers (year, month), political metrics (gov_gop, rep_dem, president), the financial index (close), and the economic indicator (unemployment_rate).


# Problem 2

1. First dataset

```{r}
mrtrash_df = 
  readxl::read_excel("./problem 2/202409 Trash Wheel Collection Data.xlsx"
                     , sheet="Mr. Trash Wheel"
                     , range = "A2:N653") |> 
  janitor::clean_names() |> 
   mutate(
    sports_balls = as.integer(round(as.numeric(`sports_balls`))),
    wheel_name = "Mr. Trash Wheel",
    year=as.numeric(year)
  ) |> 
  select(-dumpster) |> 
  relocate(year, month, wheel_name) |> 
  arrange(date)

mrtrash_df
```

2. Second dataset

```{r}
prtrash_df = 
  readxl::read_excel("./problem 2/202409 Trash Wheel Collection Data.xlsx"
                     , sheet="Professor Trash Wheel"
                     , range = "A2:M120") |> 
  janitor::clean_names() |> 
  mutate(
    wheel_name = "Professor Trash Wheel") |> 
  select(-dumpster) |> 
  relocate(year, month, wheel_name) |> 
  arrange(date)

prtrash_df
```

3. Third dataset

```{r}
gwtrash_df = 
  readxl::read_excel("./problem 2/202409 Trash Wheel Collection Data.xlsx"
                     , sheet="Gwynnda Trash Wheel"
                     , range = "A2:L265") |> 
  janitor::clean_names() |> 
  mutate(
    wheel_name = "Gwynnda Trash Wheel") |> 
  select(-dumpster) |> 
  relocate(year, month, wheel_name) |> 
  arrange(date)
  
gwtrash_df
```

4. Combine the dataset

```{r}
final_merged2_df = 
  bind_rows(mrtrash_df, prtrash_df, gwtrash_df) |>
  janitor::clean_names()

final_merged2_df
```

* The combined Trash Wheel dataset is a time-series data frame that aggregates collection metrics for three different wheels: Mr. Trash Wheel, Professor Trash Wheel, and Gwynnda. This dataset contains `r nrow(final_merged2_df)` observations, with key variables including the wheel identifier, the date, the amount of trash collected by weight, and specific item counts like plastic_bottles and cigarette_butts. Analysis of the individual wheels shows that the total weight of trash collected by Professor Trash Wheel amounts to `r 
  final_merged2_df |> 
  filter(wheel_name == "Professor Trash Wheel") |> 
  summarize(total_weight = sum(weight_tons, na.rm = TRUE)) |> 
  pull(total_weight) 
` tons. Furthermore, the total number of cigarette butts collected by Gwynnda in June of 2022 was `r 
  format (final_merged2_df |> 
  filter(wheel_name == "Gwynnda Trash Wheel", year == 2022, month == "June") |>
  summarize(total_butts = sum(cigarette_butts, na.rm = TRUE)) |>
  pull(total_butts), big.mark = ",", scientific = FALSE)` butts.
  
# Problem 3

1. First dataset

```{r}
zipcode_df = read_csv(file = "./zillow_data/Zip Codes.csv") |> 
  janitor::clean_names() |> 
  rename(county_name = county) |> 
  select(-county_fips) |> 
  relocate(zip_code, county_name) |> 
  arrange(zip_code)

zipcode_df
```

2. Second dataset

```{r}
rental_df = read_csv(file = "./zillow_data/Zip_zori_uc_sfrcondomfr_sm_month_NYC.csv") |> 
  janitor::clean_names() |> 
  pivot_longer(
    x2015_01_31:x2024_08_31,
    names_to = "rental_date", 
    values_to = "rental_price") |> 
  mutate(
    county_name = stringr::str_replace(county_name, " County", ""),
    rental_date = stringr::str_replace(rental_date, "x", "")
  ) |> 
  separate(rental_date, into = c("year", "month", "day"), sep = "_") |> 
  mutate(
    month = case_match(
      month,
      "01" ~ "jan",
      "02" ~ "feb",
      "03" ~ "mar",
      "04" ~ "apr",
      "05" ~ "may",
      "06" ~ "jun",
      "07" ~ "jul",
      "08" ~ "aug",
      "09" ~ "sep",
      "10" ~ "oct",
      "11" ~ "nov",
      "12" ~ "dec"
    ),
    year=as.integer(year),
    day=as.integer(day)) |> 
  rename(zip_code = region_name) |> 
  relocate(zip_code, county_name) |> 
  select(-state, -region_type) |> 
  arrange(zip_code)

rental_df
```

3. Merge the data

```{r}
final_merged3_df = 
  zipcode_df |>
  left_join(rental_df, by = c("zip_code", "county_name"))

final_merged3_df
```

* The resulting dataset is a tidy, time-series data frame containing rental price metrics across various geographic levels. It appears to combine Zillow rental data (indicated by columns like zip_code, region_id, and rental_price) with geographic identifiers like county_name and state_name. Each row represents a rental price observation for a specific ZIP code and month. This dataset includes a total of `r nrow(final_merged3_df)` observations. Within these records, the data covers `r data.table::uniqueN(final_merged3_df$zip_code)` unique ZIP codes and `r final_merged3_df |>
  filter(!is.na(neighborhood)) |>
  # 2. Pull the clean column as a vector
  pull(neighborhood) |>
  data.table::uniqueN()` unique neighborhoods.

* `r final_merged3_df |>
  filter(is.na(size_rank))|>
  # 2. Pull the clean column as a vector
  pull(zip_code) |>
  data.table::uniqueN()` ZIP codes appear in the ZIP code dataset but not in the Zillow Rental Price dataset. The reason is that many large office towers or institutions in major cities have their own dedicated ZIP codes. These areas have no street-level residential rentals for Zillow to track.


